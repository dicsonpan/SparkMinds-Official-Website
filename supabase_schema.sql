-- Run this SQL in your Supabase SQL Editor to set up the tables AND populate initial data

-- 1. Create Curriculum Table
create table if not exists public.curriculum (
  id text primary key, -- e.g. "L1"
  level text not null,
  age text not null,
  title text not null,
  description text not null,
  skills text[] not null,
  icon_name text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Create Philosophy Table
create table if not exists public.philosophy (
  id bigint generated by default as identity primary key,
  title text not null,
  content text not null,
  icon_name text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. Create Showcases Table
create table if not exists public.showcases (
  id bigint generated by default as identity primary key,
  title text not null,
  category text not null,
  description text not null,
  image_alt text not null, -- can store image URL here
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 4. Enable Row Level Security
alter table public.curriculum enable row level security;
alter table public.philosophy enable row level security;
alter table public.showcases enable row level security;

-- 5. Create Policies
-- Drop existing policies if they exist to avoid errors when re-running
drop policy if exists "Allow public read access" on public.curriculum;
drop policy if exists "Allow public read access" on public.philosophy;
drop policy if exists "Allow public read access" on public.showcases;
drop policy if exists "Allow authenticated update" on public.curriculum;
drop policy if exists "Allow authenticated update" on public.philosophy;
drop policy if exists "Allow authenticated update" on public.showcases;

-- Read policies (Public)
create policy "Allow public read access" on public.curriculum for select using (true);
create policy "Allow public read access" on public.philosophy for select using (true);
create policy "Allow public read access" on public.showcases for select using (true);

-- Write policies (Authenticated users only - covers Insert, Update, Delete)
create policy "Allow authenticated update" on public.curriculum for all using (auth.role() = 'authenticated');
create policy "Allow authenticated update" on public.philosophy for all using (auth.role() = 'authenticated');
create policy "Allow authenticated update" on public.showcases for all using (auth.role() = 'authenticated');

-- 6. Insert Initial Data from constants.ts

-- Insert Curriculum
INSERT INTO public.curriculum (id, level, age, title, description, skills, icon_name) VALUES
('L1', 'LEVEL 1 (6-7岁)', '空间构建与数字化启蒙', '小小造物主 · 3D设计与实体化', '不只是玩积木，而是像设计师一样思考。孩子将学习将脑海中的奇思妙想，通过TinkerCad进行3D建模，并亲手操作3D打印机将其变为现实，建立早期的空间想象力与工程概念。', ARRAY['空间想象力', '3D建模', '逆向工程思维', '动手实践'], 'Box'),
('L2', 'LEVEL 2 (7-8岁)', '物理感知与电子科学', '科学发明家 · 电子电路入门', '探索“电”的魔法。通过制作声光电小发明（如自制台灯、感应风扇），理解电路原理与传感器逻辑。从这一步开始，孩子不再是电子产品的消费者，而是创造者。', ARRAY['电路原理', '传感器应用', '科学探究', '逻辑归因'], 'Zap'),
('L3', 'LEVEL 3 (9-10岁)', '计算思维与逻辑构建', '逻辑交互 · 图形化编程进阶', '编程语言的“看图说话”。使用Mixly等工具，让硬件“活”起来（如设计点阵动画、智能温控）。重点培养计算机科学核心的“输入-处理-输出”逻辑思维，为代码编程打下地基。', ARRAY['计算思维', '流程图逻辑', '模块化设计', '软硬结合'], 'MousePointerClick'),
('L4', 'LEVEL 4 (10-11岁)', '代码进阶与自动化控制', '极客工程师 · C++与自动化', '告别图形块，开始像真正的工程师一样敲代码。学习C++语言与Arduino主板，通过制作循迹小车、智能家居原型，掌握计算机底层的控制逻辑与算法基础。', ARRAY['C++语言', '算法基础', '自动化控制', 'Debug能力'], 'Cpu'),
('L5', 'LEVEL 5 (11-13岁)', '万物互联与系统工程', '全栈初阶 · 物联网(IoT)系统', '从单机到联网的跨越。学习如何用手机远程控制硬件（如远程浇花系统）。孩子将接触Python语言，理解现代互联网设备是如何交互的，培养系统性的工程视野。', ARRAY['Python/C++', '网络通信', '系统架构', '复杂工程管理'], 'Wifi'),
('L6', 'LEVEL 6 (13-15岁)', '互联网产品开发实战', '全栈高阶 · 独立开发与部署', '具备独立开发商业级产品的能力。学习Linux服务器、数据库与网页技术。孩子将能独立搭建网站、开发小程序，打通软件与硬件的最后“一公里”。', ARRAY['Linux服务器', 'Web全栈', '数据库', '产品经理思维'], 'Globe'),
('L7', 'LEVEL 7 (15-18岁)', '前沿科技与学术科研', 'AI科学家 · 人工智能与科研', '站在科技的最前沿。接触计算机视觉、神经网络等大学级知识。我们将指导学生进行独立课题研究，产出高含金量的科研论文或项目，助力国内外名校申请。', ARRAY['AI/深度学习', '学术写作', '科研方法论', '名校背景提升'], 'Brain')
ON CONFLICT (id) DO NOTHING;

-- Insert Philosophy
INSERT INTO public.philosophy (title, content, icon_name) VALUES
('是“真做”，不是“过家家”', '市面上很多课程只是让孩子拼拼凑凑。我们坚持“全流程真做”——从设计电路板、写代码到外壳建模，让孩子掌握真正解决问题的硬核能力，而非仅仅体验乐趣。', 'Hammer'),
('不仅教技术，更懂教育', '我们拒绝焦虑式的填鸭教育。每个孩子都有自己的花期，我们提供个性化的成长路径，保护孩子的好奇心，让科技成为他们探索世界的工具，而不是枯燥的学科。', 'Sprout'),
('做孩子身边的“科技导师”', '我们的老师不仅是讲师，更是孩子科研路上的引路人（Mentor）。从Debug代码到人生规划，我们提供业内稀缺的深度陪伴，发掘每个孩子独特的闪光点。', 'HeartHandshake');

-- Insert Showcases
INSERT INTO public.showcases (title, category, description, image_alt) VALUES
('厚浪云平台', '商业级产品', '一名中学生不仅学会了编程，还创办了自己的云服务平台。这证明了我们的学员具备将技术转化为产品的实战能力，并在真实的商业世界中获得了天使投资。', 'Screenshot of HouLang Cloud platform interface'),
('智能乐谱阅读器', '国际大奖作品', '源于对音乐的热爱，孩子结合物联网技术解决了“翻谱难”的痛点。该项目跨越3年持续迭代，斩获多项国际科创大奖，成为名校申请的强力敲门砖。', 'Student presenting electronic sheet music device'),
('医用矫正护具', '跨学科应用', '通过3D扫描与人体工学设计，为患者定制低成本、高透气的康复护具。这是科技与人文关怀的完美结合，体现了孩子用技术改变生活的社会责任感。', '3D printed yellow arm guard structure'),
('田野密码 · 智慧农业', 'PBL项目式学习', '走出教室，走进田野。孩子们通过实地调研，设计了一套全自动灌溉系统。在解决真实农业问题的过程中，他们理解了什么是工程，什么是责任。', 'Students in field testing irrigation system');
